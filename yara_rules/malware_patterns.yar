
rule packed_executable {
    meta:
        description = "Packed or obfuscated executable indicators"
        severity = "MEDIUM"
    strings:
        $packer_strings = {
            "UPX" "ASPack" "PECompact" "Themida" "VMProtect" "Armadillo"
            "MPRESS" "NsPack" "telock" "Obsidium" "Enigma"
        }
        $entropy_high = "This string won't match, placeholder for entropy detection"
    condition:
        any of ($packer_strings)
}

rule process_injection {
    meta:
        description = "Process injection techniques"
        severity = "HIGH"
    strings:
        $virtual_alloc = "VirtualAllocEx"
        $write_process = "WriteProcessMemory"
        $create_remote = "CreateRemoteThread"
        $queue_user_apc = "QueueUserAPC"
        $set_window_hook = "SetWindowsHookEx"
    condition:
        3 of them
}

rule anti_debugging {
    meta:
        description = "Anti-debugging techniques"
        severity = "MEDIUM"
    strings:
        $is_debugger = "IsDebuggerPresent"
        $nt_query = "NtQueryInformationProcess"
        $check_remote = "CheckRemoteDebuggerPresent"
        $peb_debug = "BeingDebugged"
        $timing_check = "GetTickCount"
    condition:
        2 of them
}
